'use strict'

const test = require('tape')
const renderThemes = require('../src/render-themes.js')

function testStr (opts) {
  return `"
" ${opts.name} v2.1.0
" description d
" author: author a
" license: MIT
"
" This file was generated by Estilo
" https://github.com/jacoborus/estilo

let g:colors_name="${opts.name}"
hi clear
if exists("syntax_on")
  syntax reset
endif
if has("gui_running")
  set background=${opts.background}
endif

hi hitest guifg=#bbddff ctermfg=153 guibg=#ffffff ctermbg=15 gui=NONE cterm=NONE
hi other guifg=#ff0000 ctermfg=9 guibg=NONE ctermbg=NONE gui=bold,underline,italic cterm=bold,underline,italic
hi link linked other\n`
}

test('renderThemes', t => {
  const schema = {
    info: {
      author: 'author a',
      background: 'dark',
      description: 'description d',
      license: 'MIT',
      url: 'url u',
      version: '2.1.0'
    },
    palette: {
      azul: '#bbddff',
      blanco: '#ffffff'
    },
    themes: {
      one: {
        name: 'onename',
        background: 'dark',
        colors: {
          blue: '@azul',
          blanco: '@blanco'
        }
      },
      two: {
        name: 'twoname',
        background: 'light',
        colors: {
          blue: '@azul',
          blanco: '@blanco'
        }
      }
    },
    templates: {
      hitest: 'blue blanco',
      other: '#ff0000 - bui',
      linked: '@other'
    }
  }

  const opts = {
    one: {
      name: 'onename',
      background: 'dark'
    },
    two: {
      name: 'twoname',
      background: 'light'
    }
  }

  let result = renderThemes(schema)
  t.is(result.themes.one.out, testStr(opts.one))
  t.is(result.themes.two.out, testStr(opts.two))
  t.end()
})
